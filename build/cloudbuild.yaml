
steps:
  - name: 'gcr.io/cloud-builders/zip'
    id: 'Zip Source'
    dir: src/convert-starter
    args: ['-r', '../../artifacts/convert-starter.zip', '.']

  - name: 'gcr.io/cloud-builders/gsutil'
    id: 'Upload to GCS'
    args: ['cp', 'artifacts/convert-starter.zip', 'gs://video-converter-src-bucket/convert-starter.zip']

  - name: 'hashicorp/terraform:light'
    id: 'Terraform Init'
    dir: infra
    entrypoint: sh
    args: ['-c', 'terraform init']

  - name: 'hashicorp/terraform:light'
    id: 'Terraform Apply'
    dir: infra
    entrypoint: sh
    args: ['-c', 'terraform apply -auto-approve']

options:
  logging: CLOUD_LOGGING_ONLY

substitutions:
  _REGION: asia-northeast1
